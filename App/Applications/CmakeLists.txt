set(APP_SOURCES
    ./Src/motor.cpp
    ./Src/encoder.cpp
    ./Src/calibrator.cpp
    ./Src/controller.cpp
    ./Src/speed_tracker.cpp
    ./Src/position_tracker.cpp
    ./Src/pid.cpp
    ./Src/dce.cpp
    ./Src/packet_handler.cpp
    ./Src/move_reconstructor.cpp
    ./Src/current_tracker.cpp
    #./Src/main.cpp
)

# 根据条件添加源文件
if(MAIN IN_LIST TARGETS_TO_BUILD)
    list(APPEND APP_SOURCES ./Src/main.cpp)
    add_executable(app ${APP_SOURCES})
elseif(APP_TEST IN_LIST TARGETS_TO_BUILD)
    message(STATUS "Building application test")
    list(APPEND APP_SOURCES ./Src/test.cpp)
    add_executable(app ${APP_SOURCES})
elseif(APP_CALIBRATION_TEST IN_LIST TARGETS_TO_BUILD)
    message(STATUS "Building calibration test")
    list(APPEND APP_SOURCES ./Src/calibrator_test.cpp)
    add_executable(app ${APP_SOURCES})
elseif(APP_CONTROL_TEST IN_LIST TARGETS_TO_BUILD)
    message(STATUS "Building controller test")
    list(APPEND APP_SOURCES ./Src/control_test.cpp)
    add_executable(app ${APP_SOURCES})
elseif(PACKET_TEST IN_LIST TARGETS_TO_BUILD)
    message(STATUS "Building packet test")
    list(APPEND APP_SOURCES ./Src/packet_test.cpp)
    add_executable(app ${APP_SOURCES})
endif()

#包含 cmake 文件夹中的头文件
target_include_directories(app PUBLIC
    ${CMAKE_CURRENT_SOURCE_DIR}/Inc
)

# 链接 stm32cubemx 库
#target_link_directories(drivers PRIVATE ${CMAKE_SOURCE_DIR}/App/Peripherals)

target_link_libraries(app drivers)